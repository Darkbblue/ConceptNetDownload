# 数据获取与筛选
## 概述
本图谱中的数据可以分为两类，文本数据与其他模态数据。  
文本数据是图谱的骨架，定义了图谱中实体与关系之间的连接关系。  
其他模态数据包含音频、图片、视频(动图)三种模态，对齐到文本数据形成的图谱上。  


## 文本数据
### 获取
#### 数据来源
文本数据来源于已有的成熟知识图谱ConceptNet。该项目通过URI的方式对内容进行管理。  
ConceptNet提供了两种获取其中数据的方式，分别是Web API和将整个图谱在本地进行编译。考虑到获取文本数据的效率并非本图谱的构造爬虫的瓶颈，我们使用Web API进行数据获取。  
更具体的API使用方法可以参考ConceptNet项目的文档。  
#### 遍历图谱
使用BFS策略对ConceptNet进行遍历，并将经过的实体或关系通过API下载到本地。  
### 筛选
#### 进行筛选的必要性
ConceptNet中的数据并非全部可归入常识范畴，并且其中的一些关系类型(如过于宽泛的RelatedTo)难以添加高质量的其他模态数据。而本项目所构建的是多模态常识图谱，因此有必要对ConceptNet中的数据进行筛选，仅保存高质量的数据，客观上形成一个小规模的ConceptNet子图。  
按照特定的规则对实体和关系进行筛选，对于未通过筛选的实体和关系，不仅不会下载到本地添加到本图谱中，**而且在BFS策略中会被视为不存在**。也就是说，BFS的最终结果一定是一个在本地完全连通的子图。  
#### 筛选规则
仅保留英语实体以及两端实体均为英语的关系。  
仅保留两端均为实体的关系，从而排除ExternalURL。  
对于权重小于1的关系，不保存。这类关系通常是ConceptNet中残留的低质量数据，标注的关系类型不符合其文档中描述的标准关系类型。  
根据关系的类型进行筛选，保留如下类型的关系：  
```python
[
	'/r/IsA', '/r/PartOf', '/r/HasA', '/r/UsedFor', '/r/CapableOf', '/r/HasProperty', '/r/MannerOf',
	'/r/MadeOf', '/r/ReceivesAction', '/r/AtLocation', '/r/Causes', '/r/HasSubevent', '/r/HasFirstSubevent',
	'/r/HasLastSubevent', '/r/HasPrerequisite', '/r/MotivatedByGoal', '/r/ObstructedBy', '/r/Desires',
	'/r/CreatedBy', '/r/DistinctFrom', '/r/SymbolOf', '/r/DefinedAs', '/r/LocatedNear', '/r/HasContext',
	'/r/SimilarTo', '/r/CausesDesire'
]
```
### 组织
本地的文本数据以图数据库neo4j的形式组织，具体方案可参考数据库相关文档。  
### 结论
文本数据构成了本图谱的骨架。根据数据来源和筛选规则，本图谱是原ConceptNet一个相对小规模的连通子图，保证更接近常识知识并且适合进行其他模态数据的对齐。  


## 其他模态数据
### 释义
本图谱中的其他模态数据或"多模态数据"共包含三种模态。  
音频模态为.mp3或.wav格式的音频文件。  
图像模态为.jpg格式的图片文件。  
视频模态为.gif格式的动图文件。  
### 筛选
本图谱考虑到要便于进行常识推理，所以并未将实体和关系仅限制为适合添加多模态的数据，而是保留了一些虽然不适合添加多模态数据但是对推理有帮助的数据。因此，在添加多模态时需要再进行一次筛选。  
全部实体均添加多模态。关系则再次按照类型进行筛选，在上文提到的保存到本地的关系类型中，**不**添加多模态的关系类型如下：  
```python
[
	'/r/IsA/', '/r/MannerOf/', '/r/HasSubevent/', '/r/HasFirstSubevent/', '/r/HasLastSubevent/',
	'/r/HasPrerequisite/', '/r/MotivatedByGoal/', '/r/ObstructedBy/', '/r/Desires/', '/r/DistinctFrom/',
	'/r/SymbolOf/', '/r/DefinedAs/', '/r/HasContext/', '/r/SimilarTo/', '/r/CausesDesire/', '/r/NotDesires/'
]
```
### 获取
#### 来源
音频模态来源于Freesound网站。  
另外两个模态来源于Google的图像搜索功能。  
#### 检索方式
使用上述渠道对多模态数据进行检索时，需要将实体或关系表述为自然语言文本，而不能直接使用uri等表示方式。  
ConceptNet提供了一个工具，可以将实体从uri转化为自然语言标签。在对实体进行多模态对齐时，直接使用此工具。  
在对关系进行多模态对齐时，首先将其两端的实体用上述方式转化为自然语言，然后根据关系的类型添加中间的连接词，具体方案如下：  
```python
if edge in ['/r/PartOf/', '/r/HasProperty/', '/r/AtLocation/', '/r/Causes/']:
	relation = ''
elif edge == '/r/HasA/':
	relation = 'has '
elif edge == '/r/UsedFor/':
	relation = 'used for '
elif edge == '/r/CapableOf/':
	relation = 'can '
elif edge == '/r/MadeOf/':
	relation = 'is made of '
elif edge == '/r/ReceivesAction/':
	relation = 'can be '
elif edge == '/r/CreatedBy/':
	relation = 'created by '
elif edge == '/r/LocatedNear/':
	relation = 'near '
```
### 组织
本图谱同时将多模态数据对齐到实体和关系上，这一点有别于以往的带有多模态的图谱。  
从更工程的角度讲，我们将多模态数据保存到本地文件系统中，然后将相对路径添加为图数据库中实体或关系的一个字段，这样可以从实体或关系直接访问其对应的多模态数据。  
